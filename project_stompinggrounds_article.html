
<!DOCTYPE html>
            <html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#">
                <head>
                    <title>Torvid</title>
                    <meta property="og:image" content="Sergal and Dragon in though 9 levels of furry-stomping goodness. :>" />
                    <meta property="og:title" content="Stomping Grounds" />
                    <meta property="og:site_name" content="torvid.net" />
                    <meta property="og:description" content="Game where you get to control legs and feet of an Eagle" />

                    <link rel="shortcut icon" href="/favicon.jpg" />
                    <link rel="stylesheet" href="/styles.css">


                    <!-- Global site tag (gtag.js) - Google Analytics -->
                    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-61846769-2"></script>
                    <script>
                      window.dataLayer = window.dataLayer || [];
                      function gtag(){dataLayer.push(arguments);}
                      gtag('js', new Date());

                      gtag('config', 'UA-61846769-2');
                    </script>


                </head>
                <!--<script src="/functions.js"></script>-->
                <body bgcolor="black">

        
                <CustomCenter>
                    <!--<p>pw.torvid.vore<p>-->
                    <h1>torvid.net</h1>
                    &nbsp;<a href="/home" id = "MainLink">Home</a>&nbsp;
                    &nbsp;<a href="/gallery" id = "ImagesLink">Renders</a>&nbsp;
                    &nbsp;<a href="/commissions" id = "commissionsLink">Art Gallery</a>&nbsp;
                    
                    <br/>
                    <br/>
                </CustomCenter>
            <hr/>
            
		<CustomCenter>
			<br/>
			<h2>Game stuff</h2>
			
			
			Following are a bunch of misc things to do with the game and its development.<br/><br/>
			
<link rel="stylesheet" href="website/styles.css">
Table of contents
<br>

			<ul>
				<li><a href="#2D Art">2D Art</a></li>
				<li><a href="#Mud tech">Mud tech</a></li>
				<li><a href="#Walking system">Walking system</a></li>
				<li><a href="#Minimap & Fog of war">Minimap & Fog of war</a></li>
				<li><a href="#Level Scripting">Level Scripting</a></li>
				<li><a href="#Abilities">Abilities</a></li>
			</ul>
			
		<br/>
		<h3 id="2D Art">2D Art</h3>
		
			During development, this game had silly MS-paint placeholder icons everywhere. As things started getting more and more polished art-wise I thought it would be really cool to comission someone to draw proper icons and panels for the game. <a href="">MagPi</a> offered to take on the comission, and did an absolutely amazing job.
			
			<br/>
			<br/><br/><br/>
			Extra Animations<br/><br/>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_EagleIntro.png"				><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_EagleIntro.jpg"			></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_FaceSuck.png"				><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_FaceSuck.jpg"				></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_PoleSitCrush.png"			><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_PoleSitCrush.jpg"			></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_puddlepawpress.png"			><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_puddlepawpress.jpg"		></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_SergalIntro.png"				><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_SergalIntro.jpg"			></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_sizechange.png"				><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_sizechange.jpg"			></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_SoftVoreCrunch.png"			><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_SoftVoreCrunch.jpg"		></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_TorvidButtLick.png"			><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_TorvidButtLick.jpg"		></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_TorvidCrotchSquish.png"		><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_TorvidCrotchSquish.jpg"	></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_TorvidForetalonPress.png"	><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_TorvidForetalonPress.jpg"	></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_TorvidMacroStep.png"			><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_TorvidMacroStep.jpg"		></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_TorvidMudStompPiss.png"		><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_TorvidMudStompPiss.jpg"	></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_TorvidPawCrushFap.png"		><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_TorvidPawCrushFap.jpg"		></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_VineMonsterDrown.png"		><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_VineMonsterDrown.jpg"		></a>
			<a href="website/content/projects/StompingGrounds/2dArt/ExtraAnimation_WaterTorvid.png"				><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/ExtraAnimation_WaterTorvid.jpg"			></a>
			<br/><br/><br/>
			Player and Ability icons<br/><br/>
			<a href="website/content/projects/StompingGrounds/2dArt/Eagle.png"									><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/Eagle.jpg"								></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Eagle_Q_Wipe.png"							><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/Eagle_Q_Wipe.jpg"							></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Eagle_W_Jump.png"							><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/Eagle_W_Jump.jpg"							></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Eagle_E_Screech.png"						><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/Eagle_E_Screech.jpg"						></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Eagle_R_Fly.png"							><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/Eagle_R_Fly.jpg"							></a>
			<br/>
			<a href="website/content/projects/StompingGrounds/2dArt/sergal.png"									><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/sergal.jpg"								></a>
			<a href="website/content/projects/StompingGrounds/2dArt/sergal_Q.png"								><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/sergal_Q.jpg"						></a>
			<a href="website/content/projects/StompingGrounds/2dArt/sergal_W.png"								><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/sergal_W.jpg"						></a>
			<a href="website/content/projects/StompingGrounds/2dArt/sergal_E.png"								><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/sergal_E.jpg"						></a>
			<a href="website/content/projects/StompingGrounds/2dArt/sergal_R_.png"								><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/sergal_R.jpg"							></a>
			<br/>		
			<a href="website/content/projects/StompingGrounds/2dArt/dragon.png"									><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/thumbs/dragon.jpg"								></a>
			<a href="website/content/projects/StompingGrounds/2dArt/dragon_Q.png"								><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/dragon_Q.jpg"						></a>
			<a href="website/content/projects/StompingGrounds/2dArt/dragon_W.png"								><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/dragon_W.jpg"						></a>
			<a href="website/content/projects/StompingGrounds/2dArt/dragon_E.png"								><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/dragon_E.jpg"						></a>
			<a href="website/content/projects/StompingGrounds/2dArt/dragon_R.png"								><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/thumbs/dragon_R.jpg"							></a>
			<br/><br/><br/>
			Enemy emotion icons<br/><br/>
			<a href="website/content/projects/StompingGrounds/2dArt/Entity_wuff.png"							><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/Entity_wuff.png"					></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Entity_wuffArcher.png"						><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/Entity_wuffArcher.png"		></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Entity_wuffMusketeer.png"					><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/Entity_wuffMusketeer.png"		></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Entity_wuffWarrior.png"						><img width="150" height="150" src="website/content/projects/StompingGrounds/2dArt/Entity_wuffWarrior.png"		></a>
			<br/><br/><br/>
			Enemy emotion icons<br/><br/>
			<a href="website/content/projects/StompingGrounds/2dArt/Wuff_Stunned.png"							><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/Wuff_Stunned.png"></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Wuff_Straining.png"							><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/Wuff_Straining.png"></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Wuff_Scared.png"							><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/Wuff_Scared.png"></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Wuff_OnFire.png"							><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/Wuff_OnFire.png"></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Wuff_Neutral.png"							><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/Wuff_Neutral.png"></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Wuff_Hurt.png"								><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/Wuff_Hurt.png"></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Wuff_Drowning.png"							><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/Wuff_Drowning.png"></a>
			<a href="website/content/projects/StompingGrounds/2dArt/Wuff_ANGERY.png"							><img width="100" height="100" src="website/content/projects/StompingGrounds/2dArt/Wuff_ANGERY.png"></a>
			<br/>
			
			
			
		<br/>
		<br/>
		<br/>
		<br/>
		<h3 id="Mud tech">Mud tech</h3>
		<hr/>
			This whole game actually started as an mud simulation experiment. First in UE4, then moved to unity. The scope was much smaller, and it eventually grew to this whole thing. There's a bunch of things going on with the mud.
			
			The quick overview is the surface of the mud is simply a tesselated plane, where the heigh at any point is decided by a greyscale texture.
			
			<h4>Readback</h4>
				<video style="float: right; max-width: 50%;" autoplay loop muted><source src="ripples1.mp4" type="video/mp4"></video>
				<video style="float: right; max-width: 20%; " autoplay loop muted><source src="mudewater1.mp4" type="video/mp4"></video>
				Copying the texture back into RAM was important for getting it interactive. Copying the whole texture turned out to be too slow, so before copying, I draw the current texture over to a textuer that's only 128x128.
			<h4>Painting objects</h4>
				To make it so that things that touch the mud become "muddy" Each object has a 512x512 render-texture assigned to it. a shader is executed on this texture every frame, it transforms the pixel position from UV-Space to world space, then from world space to the space of the mud surface, then it samples the mud height and checks if it's below, if it is, it then edits that pixel to have mud on it.
				UV -> World Space-> Mud Surface Space
			<h4>Objects painting denting the heightmap</h4>
				This is done by drawing the object orthographically from the bottom, reading the distance to the object and drawing it to the heightmap, causing it to dent.
			<h4>Objects painting blood on the heightmap</h4>
				Blood works similarly, each object has a "bloodness" parameter, which is used to blend in blood wheever the object touches the surface.
			<h4>Mud smoothing and Water ripples (wave equation)</h4>
				For simulating the behaviour of soft mud, any soft mud is gently blurred over time.
				The water has a simlar effect applied to it every frame, except instead of a blur it's a finite differances discretization of the wave equation, similar to how one would simulate sound bouncing around a room.<br/><br/>
			<h4>Mud rising (sobel)</h4>
				To make it look like the mud gets "pushed out" around objects that press into it, a post-process effect called "Sobel" is applied to the heightmap during rendering. This makes the sides of any curved shapes rise up a little.<br/><br/>
				<video style="max-width: 20%;" autoplay loop muted><source src="muddeform1.mp4" type="video/mp4"></video>
				<video style="max-width: 20%;" autoplay loop muted><source src="muddeform2.mp4" type="video/mp4"></video>
				<br/>
				You can see the mud rise on soft ground (left), but stay fir on hard ground (right)
		<br/>
		<br/>
		<br/>
		<br/>
		<h3 id="Walking system">Walking system</h3>
		<hr/>
			The walking system has a lot of stuff going on, was one of the earliest systems written, and therefore also one of the most messy and poorly thought-through.
			There are a couple key components: 
			
			<ul>
				<li><b>Walking trail generation</b>, basically picking where the feet should be palced and consuming that trail over time.</li>
				<li><b>Step-To</b> functions for each leg.</li>
				<li><b>Inverse Kinematics</b>, for accurately controlling how each joint in the leg rotates</li>
			</ul>
			<br/><br/>
			I'll start with the easiest first:
			<h4>IK.</h4>
				<video style="float: right; max-width: 20%;" autoplay loop muted><source src="ik1.mp4" type="video/mp4"></video>
				The first IK implementation was a simple itterative method (explained here: <a href="https://www.youtube.com/watch?v=rTF0PWnRUrw">Handmade Hero Chat 007 - Inverse Kinematics</a>)<br/>
				It was both bug-prone (getting stuck at hyperextensions and singularities) and was also expensive, needing lots of itteration steps per frame.
				Around halfway through development, I realized that there's a clean analytic solution in the form of simple circle-circle intersection. for three-joint IK, the two solutions just pop out almost for free.
				<br/><br/><br/><br/><br/><br/><br/><br/>
				
			<h4>Step-To.</h4>
				<video style="float: right; max-width: 40%;" autoplay loop muted><source src="ik2.mp4" type="video/mp4"></video>
				this is basically one layer above directly controlling the leg target positions, a function called "Step To" animates the toes and IK-Target over time, moving it from its current position to the target position in a nice stepping motion.
				This function is used both in actions when the player needs to step somewhere, and for walking around.
				<br/><br/><br/><br/><br/><br/><br/><br/>
				
			<h4>Walking trail generation</h4>
				<video style="float: right; max-width: 40%;" autoplay loop muted><source src="ik3.mp4" type="video/mp4"></video>
				This part is probably one of the first things I would re-write if I was to make a sequel to this game.<br/>
				When you right-click, a sequence of "step locations" need to be generated. I call this sequence of steps a "walking trail". The trail is generated when you right click, and "consumed" step-by-step as the character walks along it.<br/><br/>
				The problems encountered writing this system were uncountable<br/>
				
					If the clicked location is at an angle more than 45 degrees, an extra "turning" trail is generated and injected before the walking trail, so that the player turns around before walking in the desired direction.<br/>
					If the player is currently being targeted by an enemy, this turning trail is not generated, and the player instead "strafes" in whatever direction you clicked. This was required to make the gameplay feel snappy. If you are under attack and need to escape, having to wait for the player to turn felt really, really bad.<br/>
					<br/><br/><br/><br/><br/><br/>
				
			<h4>Other notes</h4>
				The hips of the player smoothly lerps to line up with the two paws. So the body actually follows the paws, not the other way around.
				The height of the paw placement automatically matches the height of the mud. This is done by copying back a lower-res version of the mud heightmap into RAM every frame and sampling it.
					These samples are actually taken around the paw, never right under it. If the samples were taken under the paw, it would feedback-loop, digging itself into the ground. (Paw pushes mud down, samples a lower depth, pushing the mud down further etc etc forever.)
					
		<br/>
		<br/>
		<br/>
		<br/>
		<h3 id="Minimap & Fog of war">Minimap & Fog of war</h3>
		<hr/>
			<video style="float: right;" autoplay loop muted><source src="minimap1.mp4" type="video/mp4"></video>
			<h4>Minimap</h4>
			The minimap is quite simple, but took a lot longer than expected because of not being familliar with unity's HDRP. <br/><br/>
			
			The surface itself is a small render-texture. Each entity that's drawn to the minimap has a "minimap icon" component and some settings for how bg it should be etc. I loop over all these components and draw them to the minimap one by one.
			The overhead from doing this in HDRP turned out to be very high, so I stagger it over a couple frames, you can see this in the minimap running at a lower framerate than the main game. I noticed the minimap in StarCraft 2 does something similar, though probably for different reasons.<br/><br/>
			If you look closely you can see that the minimap draws your footsteps as you walk around. :><br/><br/>
		
			<h4>Fog of war</h4>
			The fog of war is created using a render-texture and a big plane which covers the entire level. To reveal parts of the fog of war, parts the texture can be made transparent by drawing a circle to it.<br/><br/>
			Any mesh that would normally "stick through" this plane makes itself invisible above the plane when there is fog in the way.<br/><br/>
			<img style="max-width: 100%;" src="fog_of_war_2.png"></img><br/><br/>
			Fog mesh (left), Fog mesh Hidden (Right).
			
		<br/>
		<br/>
		<br/>
		<br/>
		<h3 id="Barks">Barks</h3>
		<hr/>
			<video style="float: right; max-width: 50%;" autoplay loop muted><source src="barks1.mp4" type="video/mp4"></video>
			Barks were a late addition I almost forgot about! boy am I glad I found the time to add them, because they add *so much* to the game. <br/><br/>
			
			It's all driven by a text file which has tags for various events and options for what character should say something, under what conidtion, and what % chance to say it.<br/>
			formatted like so:<br/><br/>
			<code>
				[EnemyCrawlingAwayFromPlayer]<br/>
				10%, PlayerEagle<br/>
				How cute, you think you can actually get away?<br/>
				10%, Player<br/>
				Down in the mud where you belong.<br/>
				10%, PlayerSergal<br/>
				Crawl for your miserable life<br/>
				10%, PlayerSergal<br/>
				I'll break every bone in your body!<br/>
				10%, TargetedEnemy<br/>
				It hurts so much<br/>
				10%, TargetedEnemy<br/>
				Just let me go... please.<br/>
				10%, TargetedEnemy<br/>
				h.. help. anyone<br/>
				</code>
		<br/>
		<br/>
		<br/>
		<br/>
		<h3 id="Level Scripting">Level Scripting</h3>
		<hr/>
			<img style="float: right;"  src="scripting3.png"></img>
			For controlling scripted event such as bjectives, wind conditions, moving the camera, spawning enemies, etc, I created a simple "entities & events" system, where I have a set of entities, each of which can fire events and recieve events from other entities<br/><br/>
			Some exmaples include Enemies, who have an OnDied event, used for completing objectives when they are killed. and can receive events, such as WalkToWaypoint() for getting it to walk somewhere.<br/>
			Trigger boxes, for firing events when the player or an enemy walks into them.<br/><br/>
			
			There are also some specialized entities, like "Animation" which just plays an animation in the scene, used in the first and third level for a simple cutscene.<br/><br/><br/>
			<img style="max-width: 75%;" src="scripting2.png"></img><br/><br/>
			
		<br/>
		<br/>
		<br/>
		<br/>
		<h3 id="Abilities">Abilities</h3>
		<hr/>
			<video style="float: right; max-width: 50%;" autoplay loop muted><source src="Action2.mp4" type="video/mp4"></video>
			The player abilites Q, W, E, R are another big topic with lots of stuff going on.<br/><br/>
			When you press one of the abilities or hotkeys, an instance of an "Action" class is created, this class has a start and update function, as well as access to the scene, player and mouse cursor.
			Each action has various states it goes through, <br/>
			<ul>
				<li><b>Choosing</b>, (The ability has been clicked, and the player is deciding weather they want to activate or cancel it.</li>
				<li><b>Executing</b>, (the ability is currently playing some animation)</li>
				<li><b>Coolingdown</b>, (the ability is on cooldown and cannot be reactivated)</li>
				<li><b>Done</b>, (The ability has finished and the class can now be destroyed)</li>
			</ul>
				
			You'll notice some abilities skip the "choosing" stage entirely, such as the eagle screech, skipping straight to executing when clicked.
			<br/><br/><br/>
			
			One mistake made early on, "Walking" (right click) in the game uses this same Action system. This lead to some messy code to do with making the walk ability cancellable *while* executing, and also making its hotkey be right-click. it just became a mess. walking should have been its own separate system entirely. Good example of leaning too hard into code reuse early on.<br/><br/>
			<img style="max-width: 75%;" src="Abilities1.png"></img><br/><br/>
			<br/><br/>
		</CustomCenter>
        
            <hr/>
		    <CustomCenter>
                Last updated 2022-03-11<br/>
                <br/>
                If you let me get at you it's only a matter of time before you end up under my paws or in my beak.<br/>
                I am best reached on my Discord: <a href="https://discord.gg/ZQpTQYZ">https://discord.gg/ZQpTQYZ</a> 
                <br/>
                <br/>
		    </CustomCenter>
</body> 
            </html>